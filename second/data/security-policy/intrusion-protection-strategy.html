<!--5.2.安全策略-入侵防护策略-->
<div id="intrusion-protection-strategy" class="page-content-wrapper">
    <div class="page-content portlet-wrapper">
        <!--第一行 页签-->
        <div class="portlet tab-border">
            <div class="portlet-title">
                <ul class="nav nav-tabs " role="tablist">
                    <li role="presentation" class="active">
                        <a href="#intrusion-protection" aria-controls="home" role="tab" data-toggle="tab">入侵防护策略</a>
                        <span class="selected"></span>
                    </li>
                    <li role="presentation">
                        <a href="#characteristics" aria-controls="home" role="tab" data-toggle="tab">特征库</a>
                        <span></span>
                    </li>
                    <li role="presentation">
                        <a href="#exceptions-host" aria-controls="home" role="tab" data-toggle="tab">例外主机</a>
                        <span></span>
                    </li>
                </ul>
            </div>
        </div>
        <!--第二行 页签切换块-->
        <div class="tab-content">
            <!--入侵防护策略-->
            <div role="tabpanel" class="tab-pane active" id="intrusion-protection">
                <div class="portlet" >
                    <div class="portlet-title">
                        <div class="caption">
                            <ul class="bt-bars">
                                <li class="active"><a href="javascript:;"><img src="imgs/8.png"/>添加</a></li>
                                <li><a href="javascript:;"><img src="imgs/delete.png"/>删除</a></li>
                            </ul>
                        </div>
                    </div>
                    <table class="portlet-table active portlet-body-default" id="intrusion">
                        <thead>
                        <tr>
                            <td>选择</td>
                            <td data-name="name">名称</td>
                            <td>入侵防御特征</td>
                            <td>引用次数</td>
                            <td>匹配次数</td>
                            <td colspan="3">操作</td>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="8">
                                <ul>
                                </ul>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <!--特征库-->
            <div role="tabpanel" class="tab-pane" id="characteristics">
                <div class="portlet" >
                    <div class="portlet-title">
                        <div class="caption">
                            <form class="form-inline">
                                <div class="form-group">
                                    <label>查询关键字：</label>
                                    <input  id="typeTreeSearch">
                                </div>
                                <div class="form-group">
                                    <label>类型：</label>
                                    <select id="selectType">
                                        <option value="">请选择</option>
                                        <option value="1">Buffer Overflow</option>
                                        <option value="2">Dos/DDoS</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>特征：</label>
                                    <select class="feature" id="selectName">
                                        <option value="">请选择</option>
                                        <option value="1">EXPLOIT Squid Proxy Gopher Response Processing Buffer Overflow</option>
                                        <option value="2">EXPLOIT Apache HTTPD mod_proxy_ajp Denial Of Service</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>级别：</label>
                                    <select id="selectLevel">
                                        <option value="">请选择</option>
                                        <option value="1">轻微</option>
                                        <option value="2">低</option>
                                        <option value="3">中</option>
                                        <option value="4">高</option>
                                    </select>
                                </div>
                                <button type="button" class="f-btn-blue"><img src="imgs/41.png"/>查找</button>
                            </form>
                        </div>
                    </div>
                    <div class="portlet-body portlet-body-chara">
                        <div class="row">
                            <div class="col-xs-3">
                                <div class="portlet bordered" >
                                    <div class="portlet-title">基本特征库</div>
                                    <div class="portlet-body">
                                        <ul id="treeType" class="ztree"></ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-9">
                                <div class="portlet-body">
                                    <div class="pack">
                                        <div class="row">
                                            <div class="col-xs-12">
                                                特征名称<span></span>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-4">
                                                特征ID<span></span>
                                            </div>
                                            <div class="col-xs-4">
                                                危害级别<span></span>
                                            </div>
                                            <div class="col-xs-4">
                                                攻击类型<span></span>
                                            </div>
                                        </div>
                                        <div class="row cur">
                                            <div class="col-xs-12">
                                                详细描述<span></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-3">
                                <div class="portlet bordered" >
                                    <div class="portlet-title">
                                        <span>自定义特征库</span>
                                        <a href="javascript:;" class="current"><img src="imgs/ad.png"/></a>
                                        <a href="javascript:;"><img src="imgs/9.png"/></a>
                                        <a href="javascript:;"><img src="imgs/4.png"/></a>
                                        <a href="javascript:;"><img src="imgs/3.png"/></a>
                                    </div>
                                    <div class="portlet-body">
                                        <ul id="treeType2" class="ztree"></ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-9">
                                <div class="portlet-body custom">
                                    <form>
                                        <div class="row">
                                            <div class="form-group">
                                                <label>特征名称</label>
                                                <input >
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="form-group col-xs-4">
                                                <label>特征ID</label>
                                                <input  disabled>
                                            </div>
                                            <div class="form-group col-xs-4">
                                                <label>危害级别</label>
                                                <input >
                                            </div>
                                            <div class="form-group col-xs-4">
                                                <label>攻击类型</label>
                                                <input >
                                            </div>
                                        </div>
                                        <div class="form-group cur">
                                            <label>详细描述</label>
                                            <textarea></textarea>
                                        </div>
                                        <button type="button" class="btn add-btn">添加下一个</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="f-btn-blue" disabled>保存</button>
                </div>
            </div>
            <!--特例主机-->
            <div role="tabpanel" class="tab-pane" id="exceptions-host">
                <div class="portlet" >
                    <div class="portlet-title">
                        <div class="caption">
                            <ul class="bt-bars pull-left">
                                <li class="active"><a href="javascript:;"><img src="imgs/8.png"/>添加</a></li>
                                <li><a href="javascript:;"><img src="imgs/delete.png"/>删除</a></li>
                            </ul>
                            <form class="form-inline pull-left">
                                <div class="form-group">
                                    <label>特征ID：</label>
                                    <input>
                                </div>
                                <div class="form-group">
                                    <label>IP地址：</label>
                                    <input>
                                </div>
                                <button type="button" class="f-btn-blue"><img src="imgs/41.png"/>查找</button>
                            </form>
                        </div>
                    </div>
                    <table class="portlet-table active" id="exceptions">
                        <thead>
                        <tr>
                            <td>选择</td>
                            <td>特征ID</td>
                            <td>攻击类别</td>
                            <td>特征名称</td>
                            <td data-name="name">例外IP</td>
                            <td>启用</td>
                            <td colspan="3">操作</td>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="9">
                                <ul>
                                </ul>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                    <table class="portlet-table " id="filter3">
                        <thead>
                        <tr>
                            <td>选择</td>
                            <td>特征ID</td>
                            <td>攻击类别</td>
                            <td>特征名称</td>
                            <td data-name="name">例外IP</td>
                            <td>启用</td>
                            <td colspan="3">操作</td>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="9">
                                <ul>
                                </ul>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <!--提示框-->
            <div class="tip-container">
                <div class="tip">
                    <button type="button" class="close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <img/>
                    <p></p>
                    <div class="tip-footer">
                        <button type="button" class="btn">确定</button>
                        <button type="button" class="btn">取消</button>
                    </div>
                </div>
                <div class="tip1">
                    <button type="button" class="close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <img/>
                    <p></p>
                    <div class="tip-footer">
                        <button type="button" class="btn">知道了</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var selectSpan=$(".pack span"),
        selectInput=$(".custom input"),
        selectButton=$("#characteristics .form-inline button"),
        key = $("#typeTreeSearch");
    addData("intrusion");//入侵防护策略表格
    $(".nav-tabs li a").click(function () {
        var href = $(this)[0].hash;
        if (href === "#exceptions-host") {//安全策略——入侵防护策略——例外主机
            $("#exceptions").addClass("active").siblings("table").removeClass("active");//例外主机表格
            //置空搜索框
            var input = $("#exceptions-host form input");
            input[0].value = "";
            input[1].value = "";
            addData("exceptions");//加载表格内容
        } else if (href === "#intrusion-protection") {//安全策略——入侵防护策略——入侵防护策略
            addData("intrusion");//入侵防护策略表格
        }else if (href === "#characteristics") {////安全策略——入侵防护策略——特征库
            $.each(selectSpan, function (i, n) {
                n.innerHTML = "";
            });
            $.fn.zTree.init($("#treeType"), setting, invasionProtection);
        }
        $(this).siblings("span").addClass("selected");//标签下标识
    });
    key.bind("focus", focusKey)
            .bind("blur", blurKey)
            .bind("propertychange", searchNode)
            .bind("input", searchNode);
    selectButton.bind("click", searchNodes);
    $("#treeType").delegate("ul li", "click", function () {
        var li = $(this);
        $.each(invasionProtection, function (i, n) {
            (n.name === li.text() && n.ty === li.parent().siblings("a").text()) && addSpan(n, 1)
        });
    });
    $("#treeType2").delegate("ul li", "click", function () {
        var li = $(this), i;
        $.each(invasionProtectionCustom, function (i, n) {
            (n.name === li.text() && n.ty === li.parent().siblings("a").text()) && addSpan(n, 3)
        });
        for (i = 0; i < 4; i++) {
            (i != 1) && selectInput[i].setAttribute("disabled", "true");
        }
        selectTextarea[0].setAttribute("disabled", "true");
        $("#characteristics .custom button").attr("disabled", true);
    });
    var id = 1, typeArr = [], idArr = [],selectTextarea=$(".custom textarea");
    var tipC = $(".tip-container"),
            tip = $(".tip"),
            tip1 = $(".tip1"),
            tipP = $(".tip-container p");
    var tipAll=$(".tip, .tip1");
    position();
    //添加下一个
    $(".custom button").click(function () {
        var arr = [], cId = random(10000, 99999), i, information = false;
        for (i = 0; i < 4; i++) {
            if (i == 1) {
                continue;
            }
            if (selectInput[i].value === "") {
                arr.push(1);
            }
        }
        if (arr.length != 0 || selectTextarea[0].value === "") {
            tipWarning(tipC, tip1, tipP, "请先全部填写要处理的数据信息！");
        } else {
            $.each(invasionProtectionCustom, function (i, n) {
                if (n.name === selectInput[0].value && n.ty === selectInput[3].value) {
                    information = true;
                }
            });
            if (information) {
                tipWarning(tipC, tip1, tipP, "已存在重复数据信息！");
            } else {
                if (typeArr.indexOf(selectInput[3].value) == -1) {
                    invasionProtectionCustom.push({
                        "id": id,
                        "pId": 0,
                        "name": selectInput[3].value,
                        "icon": "imgs/icon04.png",
                        "isParent": true
                    });
                    typeArr[id] = selectInput[3].value;
                    id++;
                }
                while (idArr.indexOf(cId) != -1) {
                    cId = random(10000, 99999);
                }
                invasionProtectionCustom.push({
                    "id": cId,
                    "pId": typeArr.indexOf(selectInput[3].value),
                    "name": selectInput[0].value,
                    "icon": "imgs/icon02.png",
                    "ty": selectInput[3].value,
                    "l": selectInput[2].value,
                    "detail": selectTextarea[0].value
                });
                $.fn.zTree.init($("#treeType2"), setting, invasionProtectionCustom);
                for (i = 0; i < 4; i++) {
                    selectInput[i].value = ""
                }
                selectTextarea[0].value = ""
            }
        }
    });
    //添加
    $("#characteristics .row:last-child .col-xs-3 .portlet-title a:nth-child(2) img").click(function () {
        for (var i = 0; i < 4; i++) {
            (i != 1) && selectInput[i].removeAttribute("disabled");
            selectInput[i].value = ""
        }
        selectTextarea[0].removeAttribute("disabled");
        selectTextarea[0].value = "";
        $("#characteristics .custom button").attr("disabled", false);
    });
    //修改
    $("#characteristics .row:last-child .col-xs-3 .portlet-title a:nth-child(3) img").click(function () {
        var confirm = $("#characteristics .portlet>.f-btn-blue"), information = true;
        for (var i = 0; i < 4; i++) {
            (i != 1) && selectInput[i].removeAttribute("disabled");
        }
        selectTextarea[0].removeAttribute("disabled");
        confirm.attr("disabled", false);
        confirm.click(function () {
            if (typeArr.indexOf(selectInput[3].value) == -1 && selectInput[3].value !== "") {
                invasionProtectionCustom.push({
                    "id": id,
                    "pId": 0,
                    "name": selectInput[3].value,
                    "icon": "imgs/icon04.png",
                    "isParent": true
                });
                typeArr[id] = selectInput[3].value;
                id++;
            }
            $.each(invasionProtectionCustom, function (i, n) {
                if (n.id != selectInput[1].value && n.name === selectInput[0].value && n.ty === selectInput[3].value) {
                    tipWarning(tipC, tip1, tipP, "该类型下有重复名称的数据信息！");
                    information = false;
                }
            });
            if (information) {
                $.each(invasionProtectionCustom, function (i, n) {
                    if (n.id == selectInput[1].value) {
                        n.name = selectInput[0].value;
                        n.l = selectInput[2].value;
                        n.ty = selectInput[3].value;
                        n.detail = selectTextarea[0].value;
                        n.pId = typeArr.indexOf(selectInput[3].value);
                    }
                });
                $.fn.zTree.init($("#treeType2"), setting, invasionProtectionCustom);
                for (var i = 0; i < 4; i++) {
                    selectInput[i].value = ""
                }
                selectTextarea[0].value = "";
                $(this).attr("disabled", true);
                $("#characteristics .custom button").attr("disabled", false);
            }
        });
    });
    //删除
    $("#characteristics .row:last-child .col-xs-3 .portlet-title a:nth-child(4) img").click(function () {
        DelTree(0, 4, "#treeType2", invasionProtectionCustom, 1);
    });
    //复制
    $("#characteristics .row:last-child .col-xs-3 .portlet-title a:nth-child(5) img").click(function () {
        var copy = {}, arr = [], cId = random(10000, 99999), arrV = [], i;
        for (i = 0; i < 4; i++) {
            if (i == 1) {
                continue;
            }
            if (selectInput[i].value === "") {
                arrV.push(1);
            }
        }
        if (arrV.length != 0 || selectTextarea[0].value === "") {
            return;
        } else {
            $.each(invasionProtectionCustom, function (i, n) {
                if (n.id == selectInput[1].value) {
                    copy.pId = n.pId;
                    copy.icon = n.icon;
                    copy.ty = n.ty;
                    copy.l = n.l;
                    copy.detail = n.detail;
                }
                if (selectInput[0].value.indexOf("副本") == -1) {
                    if (n.name.indexOf(selectInput[0].value + "副本") != -1) {
                        arr.push(n.name);
                    }
                } else if (n.name.indexOf(selectInput[0].value.slice(0, selectInput[0].value.indexOf("副本") + 2)) != -1) {
                    arr.push(n.name);
                }
                arr.sort(function (a, b) {
                    return parseInt(b.slice(b.indexOf("副本") + 3)) - parseInt(a.slice(a.indexOf("副本") + 3))
                })
            });
            (arr.length == 0) ?
                    copy.name = selectInput[0].value + "副本(1)"
                    : copy.name = arr[0].slice(0, arr[0].indexOf("副本") + 2) + "(" + (parseInt(arr[0].slice(arr[arr.length - 1].indexOf("副本") + 3)) + 1) + ")";
            while (idArr.indexOf(cId) != -1) {
                cId = random(10000, 99999);
            }
            copy.id = cId;
            invasionProtectionCustom.push(copy);
            $.fn.zTree.init($("#treeType2"), setting, invasionProtectionCustom);
        }
        for (i = 0; i < 4; i++) {
            selectInput[i].value = ""
        }
        selectTextarea[0].value = "";
    });

    $("#exceptions,#filter3").delegate("td", "mousemove", function () {
        var td = $(this).has("span");
        if (td.length != 0) {
            var content = $(this).text().replace(/ .../, ""), str = "", j,
                    name = $(this).siblings("[data-name='name']").text()
            $.each(exceptions.data, function (i, n) {
                if (n.exceptionId[0] === content && n.featureID === name) {
                    for (j = 0; j < n.exceptionId.length; j++) {
                        str += n.exceptionId[j];
                        (j != n.exceptionId.length - 1) && (str += "、");
                    }
                }
            });
            td.poshytip({
                className: "tip-yellowsimple",
                content: str.replace(/、/g, "</br>"),
                alignTo: 'target',
                alignX: 'right',
                alignY: 'center',
                offsetX: 0,
                offsetY: 5
            });
        }
    });

    $("#exceptions-host .f-btn-blue").click(function () {
        var input = $(this).siblings().children("input"), arr = [];
        if (input[0].value === "" && input[1].value === "") {
            tipWarning(tipC, tip1, tipP, "请先输入要处理的数据信息！");
        } else if (input[0].value === "" && input[1].value !== "") {
            $.each(exceptions.data, function (i, n) {
                $.each(n.exceptionId, function (j, m) {
                    if (m === input[1].value) {
                        arr.push(n);
                    }
                })
            });
        } else if (input[0].value !== "" && input[1].value !== "") {
            $.each(exceptions.data, function (i, n) {
                if (n.featureID === input[0].value) {
                    $.each(n.exceptionId, function (j, m) {
                        if (m === input[1].value) {
                            arr.push(n);
                        }
                    })
                }
            });
        } else if (input[0].value !== "" && input[1].value === "") {
            $.each(exceptions.data, function (i, n) {
                (n.featureID === input[0].value) && arr.push(n);
            });
        }
        if (arr.length == 0) {
            tipWarning(tipC, tip1, tipP, "没有所查数据信息！")
        } else {
            $.each(exceptions, function (i, n) {
                filter3.record_count = n.record_count;
                filter3.page_size = n.page_size;
                filter3.page_count = n.page_count;
                filter3.cur_page = n.cur_page;
            });
            filter3.data = arr;
            $("#exceptions").removeClass("active").siblings("table").addClass("active");
            addData("filter3");
        }
    });

    //删除按键
    var tipC = $(".tip-container"),
            tip = $(".tip"),
            tip1 = $(".tip1"),
            tipP = $(".tip-container p"),
            child,
            tbody = $(".portlet-wrapper .tab-pane tbody");
    //删除按键
    tbody.delegate("tr td:last-child img", "click", function () {
        tipC.show();
        tip.show().siblings("div").hide();
        var text = $(this).parent().siblings("[data-name='name']").text();
        ($("#exceptions-host").hasClass("active") && $("#intrusion-protection-strategy").hasClass("active")) ?
                tipP.text("确认删除例外主机‘" + text + "’?")
                : ($("#exceptions-configuration").hasClass("active") && $("#application-security-policy").hasClass("active")) ?
                tipP.text("确认删除例外配置‘" + text + "’?")
                : tipP.text("确认删除‘" + text + "’?");
        child = $(this);
    })
        //复制按键
            .delegate("tr td:nth-last-child(2) img", "click", function () {
                var name = $(this).parent().siblings("[data-name='name']").text(), copy = {}, index = 0, j, length, arr = [];
                if ($("#application-security-policy").hasClass("active")) {
                    if ($("#WAF-strategy").hasClass("active")) {
                        length = WAFIntrusion.data.length;
                        $.each(WAFIntrusion.data, function (i, n) {
                            if (n.name === name) {
                                copy = {
                                    id: n.id + 1,
                                    feature: n.feature,
                                    agreementSafe: n.agreementSafe,
                                    contentSafe: n.contentSafe,
                                    reference: n.reference,
                                    matching: n.matching
                                };
                                index = i;
                            }
                            if (name.indexOf("副本") == -1) {
                                if (n.name.indexOf(name + "副本") != -1) {
                                    arr.push(n.name);
                                }
                            } else if (n.name.indexOf(name.slice(0, name.indexOf("副本") + 2)) != -1) {
                                arr.push(n.name);
                            }
                            arr.sort(function (a, b) {
                                return parseInt(b.slice(b.indexOf("副本") + 3)) - parseInt(a.slice(a.indexOf("副本") + 3))
                            })
                        });
                        $.each(WAFIntrusion.data, function (i, n) {
                            if (n.name === arr[0]) {
                                index = i
                            }
                        });
                        (arr.length == 0) ?
                                copy.name = name + "副本(1)"
                                : copy.name = arr[0].slice(0, arr[0].indexOf("副本") + 2) + "(" + (parseInt(arr[0].slice(arr[arr.length - 1].indexOf("副本") + 3)) + 1) + ")";
                        for (j = length - 1; j > index; j--) {
                            WAFIntrusion.data[j + 1] = WAFIntrusion.data[j];
                            WAFIntrusion.data[j + 1].id = WAFIntrusion.data[j].id + 1;
                        }
                        WAFIntrusion.data[index + 1] = copy;
                        addData("WAFIntrusion");
                    } else if ($("#exceptions-configuration").hasClass("active")) {
                        length = configuration.data.length;
                        $.each(configuration.data, function (i, n) {
                            if (n.featureID === name) {
                                copy = {
                                    id: n.id + 1,
                                    type: n.type,
                                    featureName: n.featureName,
                                    exceptionIp: n.exceptionIp,
                                    exceptionURL: n.exceptionURL
                                };
                                index = i;
                            }
                            if (name.indexOf("副本") == -1) {
                                if (n.featureID.indexOf(name + "副本") != -1) {
                                    arr.push(n.featureID);
                                }
                            } else if (n.featureID.indexOf(name.slice(0, name.indexOf("副本") + 2)) != -1) {
                                arr.push(n.featureID);
                            }
                            arr.sort(function (a, b) {
                                return parseInt(b.slice(b.indexOf("副本") + 3)) - parseInt(a.slice(a.indexOf("副本") + 3))
                            })
                        });
                        $.each(configuration.data, function (i, n) {
                            if (n.featureID === arr[0]) {
                                index = i;
                            }
                        });
                        (arr.length == 0) ?
                                copy.featureID = name + "副本(1)"
                                : copy.featureID = arr[0].slice(0, arr[0].indexOf("副本") + 2) + "(" + (parseInt(arr[0].slice(arr[arr.length - 1].indexOf("副本") + 3)) + 1) + ")";
                        for (j = length - 1; j > index; j--) {
                            configuration.data[j + 1] = configuration.data[j];
                            configuration.data[j + 1].id = configuration.data[j].id + 1;
                        }
                        configuration.data[index + 1] = copy;
                        addData("configuration");
                    }
                } else if ($("#intrusion-protection-strategy").hasClass("active")) {
                    if ($("#intrusion-protection").hasClass("active")) {
                        length = intrusion.data.length;
                        $.each(intrusion.data, function (i, n) {
                            if (n.name === name) {
                                copy = {
                                    id: n.id + 1,
                                    feature: n.feature,
                                    name: n.name,
                                    reference: n.reference,
                                    matching: n.matching
                                };
                                index = i;
                            }
                            if (name.indexOf("副本") == -1) {
                                if (n.name.indexOf(name + "副本") != -1) {
                                    arr.push(n.name);
                                }
                            } else if (n.name.indexOf(name.slice(0, name.indexOf("副本") + 2)) != -1) {
                                arr.push(n.name);
                            }
                            arr.sort(function (a, b) {
                                return parseInt(b.slice(b.indexOf("副本") + 3)) - parseInt(a.slice(a.indexOf("副本") + 3))
                            })
                        });
                        $.each(intrusion.data, function (i, n) {
                            if (n.name === arr[0]) {
                                index = i
                            }
                        });
                        (arr.length == 0) ?
                                copy.name = name + "副本(1)"
                                : copy.name = arr[0].slice(0, arr[0].indexOf("副本") + 2) + "(" + (parseInt(arr[0].slice(arr[arr.length - 1].indexOf("副本") + 3)) + 1) + ")";
                        for (j = length - 1; j > index; j--) {
                            intrusion.data[j + 1] = intrusion.data[j];
                            intrusion.data[j + 1].id = intrusion.data[j].id + 1;
                        }
                        intrusion.data[index + 1] = copy;
                        addData("intrusion");
                    } else if ($("#exceptions-host").hasClass("active")) {
                        length = exceptions.data.length;
                        $.each(exceptions.data, function (i, n) {
                            if (n.featureID === name) {
                                copy = {
                                    id: n.id + 1,
                                    type: n.type,
                                    featureName: n.featureName,
                                    exceptionId: n.exceptionId
                                };
                                index = i;
                            }
                            if (name.indexOf("副本") == -1) {
                                if (n.featureID.indexOf(name + "副本") != -1) {
                                    arr.push(n.featureID);
                                }
                            } else if (n.featureID.indexOf(name.slice(0, name.indexOf("副本") + 2)) != -1) {
                                arr.push(n.featureID);
                            }
                            arr.sort(function (a, b) {
                                return parseInt(b.slice(b.indexOf("副本") + 3)) - parseInt(a.slice(a.indexOf("副本") + 3))
                            })
                        });
                        $.each(exceptions.data, function (i, n) {
                            if (n.featureID === arr[0]) {
                                index = i;
                            }
                        });
                        (arr.length == 0) ?
                                copy.featureID = name + "副本(1)"
                                : copy.featureID = arr[0].slice(0, arr[0].indexOf("副本") + 2) + "(" + (parseInt(arr[0].slice(arr[arr.length - 1].indexOf("副本") + 3)) + 1) + ")";
                        for (j = length - 1; j > index; j--) {
                            exceptions.data[j + 1] = exceptions.data[j];
                            exceptions.data[j + 1].id = exceptions.data[j].id + 1;
                        }
                        exceptions.data[index + 1] = copy;
                        addData("exceptions");
                    }
                }
            })
        //修改按键
            .delegate("tr td:nth-last-child(3) img", "click", function () {
                var name = $(this).parent().siblings("[data-name='name']").text();
                if ($("#WAF-strategy").hasClass("active")) {
                    var input = $("#WAF-strategy-add .portlet-title table input")[0];
                    $("#WAF-strategy-add").addClass("active").siblings("div").removeClass("active");
                    input.value = name;
                    input.disabled = true;
                }
            });
    //提示面板取消和关闭按键
    $(".tip-container .close,.tip-footer button").click(function () {
        tipC.hide();
    });
    var li = $(".bt-bars li:last-child"),
            chb;
    tbody.delegate("tr td:first-child input", "click", function () {
        var chbs = $(".portlet-wrapper .tab-pane tbody tr td:first-child input");
        chb = [];
        $.each(chbs, function (i, n) {
            if (n.checked) {
                chb.push($(this));
            }
        });
        (chb.length > 0) ? li.addClass("active") : li.removeClass("active");
    });
    //多选删除按钮/
    li.click(function () {
        if ($(this).hasClass("active")) {
            tipC.show();
            tip.show().siblings("div").hide();
            ($("#exceptions-host").hasClass("active") && $("#intrusion-protection-strategy").hasClass("active")) ?
                    tipP.text("确认删除所选例外主机?")
                    : ($("#exceptions-configuration").hasClass("active") && $("#application-security-policy").hasClass("active")) ?
                    tipP.text("确认删除所选例外配置?")
                    : tipP.text("确认删除所选项？");
        } else {
            tipWarning(tipC, tip1, tipP, "请先选择要处理的数据信息！");
        }
    });
    $(".tip .tip-footer button:first-child").click(function () {
        if (li.hasClass("active")) {
            var text;
            $.each(chb, function () {
                text = $(this).parent().siblings("[data-name='name']").text();
                delInformation(text);
            });
            li.removeClass("active");
        } else {
            text = child.parents("tr").children("[data-name='name']").text();
            delInformation(text, child);
        }
    });
    position();
</script>