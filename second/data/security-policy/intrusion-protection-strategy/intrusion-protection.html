<!--安全策略-入侵防护策略-入侵防护策略-->
<div class="portlet" >
    <div class="portlet-title">
        <div class="caption caption-none">
            <ul class="bt-bars">
                <li class="active"><a href="javascript:;"><img src="imgs/8.png"/>添加</a></li>
                <li><a href="javascript:;"><img src="imgs/delete.png"/>删除</a></li>
            </ul>
        </div>
    </div>
    <table class="portlet-table active portlet-body-default portlet-body-default-none" id="intrusion">
        <thead>
        <tr>
            <td>选择</td>
            <td data-name="name">名称</td>
            <td>入侵防御特征</td>
            <td>引用次数</td>
            <td>匹配次数</td>
            <td colspan="3">操作</td>
        </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
        <tr>
            <td colspan="8">
                <ul>
                </ul>
            </td>
        </tr>
        </tfoot>
    </table>
</div>
<script>
    var tipC = $(".tip-container"),
            tip = $(".tip"),
            tip1 = $(".tip1"),
            tipP = $(".tip-container p"),
            tipAll=$(".tip, .tip1"),
            child,
            tbody = $("#intrusion tbody"),//页面表格主体
            li = $(".bt-bars li:last-child"),
            chb;
    addData("intrusion");//入侵防护策略表格
    position();
    //删除按键
    tbody.delegate("tr td:last-child img", "click", function () {
        child=$(this);
        tableDel(child,tipC,tip,tipP);
    })
    //复制按键
        .delegate("tr td:nth-last-child(2) img", "click", function () {
                var name = $(this).parent().siblings("[data-name='name']").text(),//对应行的名称
                    copy = {},//复制的预备对象
                    index = 0,
                    length = intrusion.data.length,
                    arr = [];
                $.each(intrusion.data, function (i, n) {
                    if (n.name === name) {
                        copy = {
                            id: n.id + 1,
                            feature: n.feature,
                            name: n.name,
                            reference: n.reference,
                            matching: n.matching
                        };
                        index = i;
                    }
                    if (name.indexOf("副本") == -1) {
                        (n.name.indexOf(name + "副本") != -1) && arr.push(n.name);
                    } else if (n.name.indexOf(name.slice(0, name.indexOf("副本") + 2)) != -1) {
                        arr.push(n.name);
                    }
                    arr.sort(function (a, b) {
                        return parseInt(b.slice(b.indexOf("副本") + 3)) - parseInt(a.slice(a.indexOf("副本") + 3))
                    })
                });
                $.each(intrusion.data, function (i, n) { (n.name === arr[0]) && (index = i) });
                (arr.length == 0) ? copy.name = name + "副本(1)"
                                    : copy.name = arr[0].slice(0, arr[0].indexOf("副本") + 2) + "(" + (parseInt(arr[0].slice(arr[arr.length - 1].indexOf("副本") + 3)) + 1) + ")";
                for (var j = length - 1; j > index; j--) {
                    intrusion.data[j + 1] = intrusion.data[j];
                    intrusion.data[j + 1].id = intrusion.data[j].id + 1;
                }
                intrusion.data[index + 1] = copy;
                addData("intrusion");
            })
    //修改按键
        .delegate("tr td:nth-last-child(3) img", "click", function () {
            var name = $(this).parent().siblings("[data-name='name']").text();
        })
    //选择框
        .delegate("tr td:first-child input", "click", function () {
            checkBox(li);
        });
    //多选删除按钮/
    li.click(function () {
        var me=$(this);
        liDel(me,tipC,tip,tipP,tip1);
    });
</script>