<!--5.3安全策略-应用安全策略-->
<div id="application-security-policy" class="page-content-wrapper">
    <div class="page-content portlet-wrapper">
        <!--第一行 页签-->
        <div class="portlet tab-border">
            <div class="portlet-title">
                <ul class="nav nav-tabs " role="tablist">
                    <li role="presentation" class="active">
                        <a href="#WAF-strategy" aria-controls="home" role="tab" data-toggle="tab">WAF策略</a>
                        <span class="selected"></span>
                    </li>
                    <li role="presentation">
                        <a href="#application-characteristics" aria-controls="home" role="tab" data-toggle="tab">特征库</a>
                        <span></span>
                    </li>
                    <li role="presentation">
                        <a href="#exceptions-configuration" aria-controls="home" role="tab" data-toggle="tab">例外配置</a>
                        <span></span>
                    </li>
                    <li role="presentation">
                        <a href="#WEB-leakage" aria-controls="home" role="tab" data-toggle="tab">WEB漏扫</a>
                        <span></span>
                    </li>
                    <li role="presentation">
                        <a href="#study-configuration" aria-controls="home" role="tab" data-toggle="tab">自学习配置</a>
                        <span></span>
                    </li>
                </ul>
            </div>
        </div>
        <!--第二行 页签切换块-->
        <div class="tab-content">
            <!--WAF策略-->
            <div role="tabpanel" class="tab-pane active" id="WAF-strategy">
                <div class="portlet" >
                    <div class="portlet-title">
                        <div class="caption">
                            <ul class="bt-bars">
                                <li class="active"><a href="javascript:;"><img src="imgs/8.png"/>添加</a></li>
                                <li><a href="javascript:;"><img src="imgs/delete.png"/>删除</a></li>
                            </ul>
                        </div>
                    </div>
                    <table class="portlet-table active" id="WAFIntrusion">
                        <thead>
                        <tr>
                            <td>选择</td>
                            <td>名称</td>
                            <td>WAF特征</td>
                            <td>协议安全</td>
                            <td>内容安全</td>
                            <td>引用</td>
                            <td>匹配</td>
                            <td colspan="3">操作</td>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="10">
                                <ul>
                                </ul>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <!--WAF策略添加页-->
            <div role="tabpanel" class="tab-pane waf-add" id="WAF-strategy-add">
                <div class="portlet-title">
                    <table class="portlet-table active">
                        <tr>
                            <td>名称</td>
                            <td>特征库</td>
                            <td>协议安全</td>
                            <td>内容安全</td>
                        </tr>
                        <tr role="tablist">
                            <td>
                                <input />
                            </td>
                            <td role="presentation" class="active">
                                <a href="#basic-characteristics" role="tab" data-toggle="tab">基本特征库</a>
                            </td>
                            <td role="presentation">
                                <a href="#security-agreement" role="tab" data-toggle="tab">安全选项10</a>
                            </td>
                            <td role="presentation">
                                <a href="#" role="tab" data-toggle="tab">安全选项9</a>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="tab-content">
                    <div role="tabpanel" class="portlet tab-pane active" id="basic-characteristics">
                        <div class="portlet-title">
                            <p class="pull-left p-title">
                                <i></i>
                                <span>添加例外主机</span>
                            </p>
                            <form class="form-inline pull-left">
                                <div class="form-group">
                                    <label>名称：</label>
                                    <select>
                                        <option value="">请选择</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>级别：</label>
                                    <select>
                                        <option value="">请选择</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>动作：</label>
                                    <select>
                                        <option value="">请选择</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>日志：</label>
                                    <select>
                                        <option value="">请选择</option>
                                    </select>
                                </div>
                                <button type="button" class="f-btn-blue">过滤显示</button>
                            </form>
                        </div>
                        <table class="portlet-table active" id="basicCharacteristics">
                            <thead>
                            <tr>
                                <td>启用</td>
                                <td>ID</td>
                                <td>名称</td>
                                <td>动作</td>
                                <td>日志</td>
                                <td colspan="2">操作</td>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div role="tabpanel" class="portlet tab-pane" id="security-agreement">
                        <table class="portlet-table active">
                            <thead>
                            <tr>
                                <td>启用</td>
                                <td>名称</td>
                                <td>动作</td>
                                <td>日志</td>
                                <td>匹配次数</td>
                                <td>操作</td>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                            <tfoot>
                            <tr>
                                <td colspan="10">
                                    <ul>
                                    </ul>
                                </td>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
            <!--特征库-->
            <div role="tabpanel" class="tab-pane chara" id="application-characteristics">
                <div class="portlet" >
                    <div class="portlet-title">
                        <div class="caption">
                            <form class="form-inline">
                                <div class="form-group">
                                    <label>查询关键字：</label>
                                    <input  id="typeTreeSearch1">
                                </div>
                                <div class="form-group">
                                    <label>类型：</label>
                                    <select id="selectType1">
                                        <option value="">请选择</option>
                                        <option value="1">Web_Server_Bug</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>级别：</label>
                                    <select id="selectLevel1">
                                        <option value="">请选择</option>
                                        <option value="1">轻微</option>
                                        <option value="2">低</option>
                                        <option value="3">中</option>
                                        <option value="4">高</option>
                                    </select>
                                </div>
                                <button type="button" class="f-btn-blue"><img src="imgs/41.png"/>查找</button>
                            </form>
                        </div>
                    </div>
                    <div class="portlet-body portlet-body-chara">
                        <div class="row">
                            <div class="col-xs-3">
                                <div class="portlet bordered" >
                                    <div class="portlet-title">基本特征库</div>
                                    <div class="portlet-body">
                                        <ul id="treeType1" class="ztree"></ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-9">
                                <div class="portlet-body">
                                    <div class="pack">
                                        <div class="row">
                                            <div class="col-xs-6">
                                                特征ID<span></span>
                                            </div>
                                            <div class="col-xs-6">
                                                操作系统<span></span>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-6">
                                                特征名称<span></span>
                                            </div>
                                            <div class="col-xs-6">
                                                WEB服务器<span></span>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-6">
                                                危害级别<span></span>
                                            </div>
                                            <div class="col-xs-6">
                                                数据库<span></span>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xs-6">
                                                攻击类别<span></span>
                                            </div>
                                            <div class="col-xs-6">
                                                编程语言<span></span>
                                            </div>
                                        </div>
                                        <div class="row cur">
                                            <div class="col-xs-12">
                                                详细描述<span></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-3">
                                <div class="portlet bordered" >
                                    <div class="portlet-title">
                                        <span>自定义特征库</span>
                                        <a href="javascript:;" class="curent"><img src="imgs/ad.png"/></a>
                                        <a href="javascript:;"><img src="imgs/9.png"/></a>
                                        <a href="javascript:;"><img src="imgs/4.png"/></a>
                                    </div>
                                    <div class="portlet-body">
                                        <ul id="treeType3" class="ztree"></ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-9">
                                <div class="portlet-body custom">
                                    <form>
                                        <div class="row">
                                            <div class="form-group col-xs-6">
                                                <label>特征ID</label>
                                                <input  disabled>
                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label>检测对象</label>
                                                <input >
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="form-group col-xs-6">
                                                <label>特征名称</label>
                                                <input >
                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label>匹配操作</label>
                                                <input >
                                            </div>
                                        </div>
                                        <div class="row curr">
                                            <div class="form-group col-xs-6">
                                                <label>危害级别</label>
                                                <input  class="denger"><br/>
                                                <label>攻击类别</label>
                                                <input >
                                            </div>
                                            <div class="form-group col-xs-6">
                                                <label>监测值</label>
                                                <textarea></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group cur">
                                            <label>详细描述</label>
                                            <textarea></textarea>
                                        </div>
                                        <button type="button" class="btn add-btn">添加下一个</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="f-btn-blue" disabled>保存</button>
                </div>
            </div>
            <!--例外配置-->
            <div role="tabpanel" class="tab-pane" id="exceptions-configuration">
                <div class="portlet" >
                    <div class="portlet-title">
                        <div class="caption">
                            <ul class="bt-bars pull-left">
                                <li class="active"><a href="javascript:;"><img src="imgs/8.png"/>添加</a></li>
                                <li><a href="javascript:;"><img src="imgs/delete.png"/>删除</a></li>
                            </ul>
                            <form class="form-inline pull-left">
                                <div class="form-group">
                                    <label>URL：</label>
                                    <input>
                                </div>
                                <div class="form-group">
                                    <label>特征ID：</label>
                                    <input>
                                </div>
                                <div class="form-group">
                                    <label>IP地址：</label>
                                    <input>
                                </div>
                                <button type="button" class="f-btn-blue"><img src="imgs/41.png"/>查找</button>
                            </form>
                        </div>
                    </div>
                    <table class="portlet-table active" id="configuration">
                        <thead>
                        <tr>
                            <td>选择</td>
                            <td>特征ID</td>
                            <td>特征名称</td>
                            <td>攻击类型</td>
                            <td>例外IP</td>
                            <td>例外URL</td>
                            <td>启用</td>
                            <td colspan="3">操作</td>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="10">
                                <ul>
                                </ul>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                    <table class="portlet-table " id="filter2">
                        <thead>
                        <tr>
                            <td>选择</td>
                            <td>特征ID</td>
                            <td>特征名称</td>
                            <td>攻击类型</td>
                            <td>例外IP</td>
                            <td>例外URL</td>
                            <td>启用</td>
                            <td colspan="3">操作</td>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="10">
                                <ul>
                                </ul>
                            </td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <!--例外配置添加页-->
            <div class="tab-pane con-add" id="exceptions-configuration-add">
                <div class="portlet" >
                    <div class="portlet-title">
                        <p class="p-title">
                            <i></i>
                            <span>添加/编辑</span>
                        </p>
                        <form class="form-inline">
                            <div class="form-group">
                                <label>类型：</label>
                                <select>
                                    <option value="">请选择</option>
                                    <option value="1">Web_Server_Bug</option>
                                    <option value="2">类型1</option>
                                    <option value="3">类型2</option>
                                    <option value="4">类型3</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>特征：</label>
                                <select>
                                    <option value="">请选择</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ID：</label>
                                <input >
                            </div>
                            <button type="button" class="f-btn-blue">确定</button>
                        </form>
                    </div>
                    <div>
                        <div class="row-add">
                            <label>例外IP：</label>
                            <input />
                            <img src="imgs/ad.png"/>
                            <div class="tContainer">
                                <table class="portlet-table active">
                                    <thead>
                                    <tr>
                                        <td>编号</td>
                                        <td>例外IP</td>
                                        <td colspan="2">操作</td>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="row-add">
                            <label>例外URL：</label>
                            <input />
                            <img src="imgs/ad.png"/>
                            <div class="tContainer">
                                <table class="portlet-table active">
                                    <thead>
                                    <tr>
                                        <td>编号</td>
                                        <td>例外URL</td>
                                        <td colspan="2">操作</td>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--WEB漏扫-->
            <div role="tabpanel" class="tab-pane leak" id="WEB-leakage">
                <div class="portlet" >
                    <div class="portlet-title">
                        <div class="caption">
                            <p class="pull-left p-title">
                                <i></i>
                                <span>任务列表</span>
                            </p>
                            <ul class="bt-bars pull-left">
                                <li class="active"><a href="javascript:;"><img src="imgs/8.png"/>添加</a></li>
                                <li class="active"><a href="javascript:;"><img src="imgs/copy_03.png"/>复制</a></li>
                                <li><a href="javascript:;"><img src="imgs/delete.png"/>删除</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="tContainer">
                        <table class="portlet-table active" id="task">
                            <thead>
                            <tr>
                                <td>选择</td>
                                <td>任务名称</td>
                                <td>任务状态</td>
                                <td>URL</td>
                                <td>任务类型</td>
                                <td>提交人</td>
                                <td>最后一次状态</td>
                                <td colspan="4">操作</td>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="portlet" >
                    <div class="portlet-title">
                        <div class="caption">
                            <p class="pull-left p-title">
                                <i></i>
                                <span>报告列表</span>
                            </p>
                            <form class="form-inline pull-left">
                                <div class="form-group">
                                    <label>报告名称：</label>
                                    <input class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>入口URL：</label>
                                    <input class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>生成时间：</label>
                                    <input class="form-control">
                                </div>
                                <button type="button" class="f-btn-blue"><img src="imgs/41.png"/>查找</button>
                            </form>
                        </div>
                    </div>
                    <div class="tContainer">
                        <table class="portlet-table active" id="report">
                            <thead>
                            <tr>
                                <td>选择</td>
                                <td>报告名称</td>
                                <td>扫描入口URL</td>
                                <td>漏洞数量</td>
                                <td>生成时间</td>
                                <td colspan="4">操作</td>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!--自学习配置-->
            <div role="tabpanel" class="tab-pane stu" id="study-configuration">
                <div class="portlet" >
                    <div class="portlet-title">
                        <div class="caption">
                            <p class="pull-left p-title">
                                <i></i>
                                <span>自学习配置</span>
                                <img src="imgs/7.png"/>
                                <img src="imgs/p.png"/>
                            </p>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div class="stu-row">
                            <div>
                                <span>IP/掩码</span>
                                <input />
                                <button>添加学习</button>
                                <button>添加例外</button>
                            </div>
                            <div>
                                <span>学习客户端</span><textarea></textarea>
                                <span>例外客户端</span><textarea></textarea>
                            </div>
                        </div>
                        <div class="stu-row">
                            <div>
                                <span>URL</span>
                                <input />
                                <button>添加学习</button>
                                <button>添加例外</button>
                            </div>
                            <div>
                                <span>学习URL</span><textarea></textarea>
                                <span>例外URL</span><textarea></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <p class="p-title">
                            <i></i>
                            <span>自学习内容</span>
                        </p>
                        <div>
                            <input type="checkbox" name="study" value="URL格式"/>URL格式
                            <input type="checkbox" name="study" value="Cookie格式"/>Cookie格式
                            <button>查看自学习结果</button>
                        </div>
                        <div>
                            <span>目录树结构</span>
                            <button>查看自学习结果</button>
                        </div>
                        <div>
                            <span>文件类型</span>
                            <button>查看自学习结果</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--提示框-->
            <div class="tip-container">
                <div class="tip">
                    <button type="button" class="close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <p></p>
                    <div class="tip-footer">
                        <button type="button" class="btn">确定</button>
                        <button type="button" class="btn">取消</button>
                    </div>
                </div>
                <div class="tip1">
                    <button type="button" class="close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <img/>
                    <p></p>
                    <div class="tip-footer">
                        <button type="button" class="btn">知道了</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var selectButton1=$("#application-characteristics .form-inline button"),
        selectInput=$(".custom input"),
        selectSpan=$(".pack span"),
        key1 = $("#typeTreeSearch1"),//关键字搜索框
        tip=$(".tip"), //确认删除提示框
        tipAll=$(".tip, .tip1");//所有提示框
    addData("WAFIntrusion");//WAF策略表格
    position();//提示框位置

    //页签切换
    $(".nav-tabs li a").click(function () {
        var href = $(this)[0].hash;
        if (href === "#exceptions-configuration") {//安全策略——应用安全策略——例外配置
            addData("configuration");//例外配置表格
        } else if (href === "#WEB-leakage") {//安全策略——应用安全策略——WEB扫漏
            addData("task");//任务列表
            addData("report");//报告列表
        } else if (href === "#WAF-strategy") {//安全策略——应用安全策略——WAF策略
            addData("WAFIntrusion");//WAF策略
        }else if (href === "#application-characteristics") {//安全策略——应用安全策略——特征库
            $.each(selectSpan, function (i, n) {
                n.innerHTML = "";
            });
            $.fn.zTree.init($("#treeType1"), setting, applicationSecurity);
        }
        $(this).siblings("span").addClass("selected");//标签下标识
    });

    //搜索框
    key1.bind("focus", focusKey)
            .bind("blur", blurKey)
            .bind("propertychange", searchNode)
            .bind("input", searchNode);
    selectButton1.bind("click", searchNodes);//搜索按钮
    //基本特征库树
    $("#treeType1").delegate("ul li", "click", function () {
        var li = $(this);
        $.each(applicationSecurity, function (i, n) {
            (n.name === li.text() && n.ty === li.parent().siblings("a").text()) && addSpan(n, 2)
        });
    });

    //自定义特征库树
    $("#treeType3").delegate("ul li", "click", function () {
        var li = $(this), i;
        $.each(applicationSecurityCustom, function (i, n) {
            (n.name === li.text() && n.ty === li.parent().siblings("a").text()) && addSpan(n, 4)
        });
        for (i = 0; i < 6; i++) {
            selectInput[i].setAttribute("disabled", "true");
        }
        selectTextarea[0].setAttribute("disabled", "true");
        selectTextarea[1].setAttribute("disabled", "true");
        $("#application-characteristics .custom button").attr("disabled", true);
    });

    //自定义特征库树的操作按钮
    var id1 = 1, typeArr1 = [], idArr1 = [],selectTextarea=$(".custom textarea");
    //添加下一个
    $(".custom button").click(function () {
        var arr = [], cId = random(10000, 99999), i, information = false;
        for (i = 1; i < 6; i++) {
            if (selectInput[i].value === "") {
                arr.push(1);
            }
        }
        if (arr.length != 0 || selectTextarea[0].value === "" || selectTextarea[1].value === "") {
            tipWarning(tipC, tip1, tipP, "请先全部填写要处理的数据信息！");
        } else {
            $.each(applicationSecurityCustom, function (i, n) {
                if (n.name === selectInput[2].value && n.ty === selectInput[5].value) {
                    information = true;
                }
            });
            if (information) {
                tipWarning(tipC, tip1, tipP, "已存在重复数据信息！");
            } else {
                if (typeArr1.indexOf(selectInput[5].value) == -1) {
                    applicationSecurityCustom.push({
                        "id": id1,
                        "pId": 0,
                        "name": selectInput[5].value,
                        "icon": "imgs/icon04.png",
                        "isParent": true
                    });
                    typeArr1[id1] = selectInput[5].value;
                    id1++;
                }
                while (idArr1.indexOf(cId) != -1) {
                    cId = random(10000, 99999);
                }
                applicationSecurityCustom.push({
                    "id": cId,
                    "pId": typeArr1.indexOf(selectInput[5].value),
                    "name": selectInput[2].value,
                    "icon": "imgs/icon02.png",
                    "object": selectInput[1].value,
                    "operation": selectInput[3].value,
                    "l": selectInput[4].value,
                    "ty": selectInput[5].value,
                    "detection": selectTextarea[0].value,
                    "detail": selectTextarea[1].value
                });
                $.fn.zTree.init($("#treeType3"), setting, applicationSecurityCustom);
                for (i = 0; i < 6; i++) {
                    selectInput[i].value = "";
                }
                selectTextarea[0].value = "";
                selectTextarea[1].value = "";
            }
        }
    });
    //添加
    $("#application-characteristics .row:last-child .col-xs-3 .portlet-title a:nth-child(2) img").click(function () {
        for (var i = 0; i < 6; i++) {
            (i != 4) && selectInput[i].removeAttribute("disabled");
            selectInput[i].value = ""
        }
        selectTextarea[0].value = "";
        selectTextarea[0].removeAttribute("disabled");
        selectTextarea[1].value = "";
        selectTextarea[1].removeAttribute("disabled");
        $("#application-characteristics .custom button").attr("disabled", false);
    });
    //修改
    $("#application-characteristics .row:last-child .col-xs-3 .portlet-title a:nth-child(3) img").click(function () {
        var confirm = $("#application-characteristics .portlet>.f-btn-blue"), information = true;
        for (var i = 1; i < 6; i++) {
            selectInput[i].removeAttribute("disabled");
        }
        selectTextarea[0].removeAttribute("disabled");
        selectTextarea[1].removeAttribute("disabled");
        confirm.attr("disabled", false);
        confirm.click(function () {
            if (typeArr1.indexOf(selectInput[5].value) == -1 && selectInput[5].value !== "") {
                applicationSecurityCustom.push({
                    "id": id1,
                    "pId": 0,
                    "name": selectInput[5].value,
                    "icon": "imgs/icon04.png",
                    "isParent": true
                });
                typeArr1[id1] = selectInput[5].value;
                id1++;
            }
            $.each(applicationSecurityCustom, function (i, n) {
                if (n.id != selectInput[0].value && n.name === selectInput[3].value && n.ty === selectInput[5].value) {
                    tipWarning(tipC, tip1, tipP, "该类型下有重复名称的数据信息！");
                    information = false;
                }
            });
            if (information) {
                $.each(applicationSecurityCustom, function (i, n) {
                    if (n.id == selectInput[0].value) {
                        n.object = selectInput[1].value;
                        n.name = selectInput[2].value;
                        n.operation = selectInput[3].value;
                        n.l = selectInput[4].value;
                        n.ty = selectInput[5].value;
                        n.detection = selectTextarea[0].value;
                        n.detail = selectTextarea[0].value;
                        n.pId = typeArr1.indexOf(selectInput[5].value);
                    }
                });
                $.fn.zTree.init($("#treeType3"), setting, applicationSecurityCustom);
                for (var i = 0; i < 6; i++) {
                    selectInput[i].value = ""
                }
                selectTextarea[0].value = "";
                selectTextarea[0].value = "";
                $(this).attr("disabled", true);
                $("#application-characteristics .custom button").attr("disabled", false);
            }
        });
        console.log(confirm)
    });
    //删除
    $("#application-characteristics .row:last-child .col-xs-3 .portlet-title a:nth-child(4) img").click(function () {
        DelTree(0, 6, "#treeType3", applicationSecurityCustom, 0);
    });

    //WAF添加页下的页签切换
    $("#WAF-strategy-add [role='tablist'] [role='presentation']").click(function () {
        $(this).addClass("active").siblings("[role='presentation']").removeClass("active")
    });

    //气泡提示框
    $("#exceptions-configuration,#filter2").delegate("td", "mousemove", function () {
        var td = $(this).has("span");
        if (td.length != 0) {
            var content = $(this).text().replace(/ .../, ""), str = "", j,
                    name = $(this).siblings("[data-name='name']").text()
            if (td[0].dataset.name === "ip") {
                $.each(configuration.data, function (i, n) {
                    if (n.exceptionIp[0] === content && n.featureID === name) {
                        for (j = 0; j < n.exceptionIp.length; j++) {
                            str += n.exceptionIp[j];
                            (j != n.exceptionIp.length - 1) && (str += "、");
                        }
                    }
                });
            } else if (td[0].dataset.name === "url") {
                $.each(configuration.data, function (i, n) {
                    if (n.exceptionURL[0] === content && n.featureID === name) {
                        for (j = 0; j < n.exceptionURL.length; j++) {
                            str += n.exceptionURL[j];
                            (j != n.exceptionURL.length - 1) && (str += "、");
                        }
                    }
                });
            }
            td.poshytip({
                className: "tip-yellowsimple",
                content: str.replace(/、/g, "</br>"),
                alignTo: 'target',
                alignX: 'right',
                alignY: 'center',
                offsetX: 0,
                offsetY: 5
            });
        }
    });

    //过滤按钮
    $("#exceptions-configuration .f-btn-blue").click(function () {
        var input = $(this).siblings().children("input"), arr = [],featureID=[],mark=false;
        if (input[0].value === "" && input[1].value === "" && input[2].value === "") {
            tipWarning(tipC, tip1, tipP, "请先输入要处理的数据信息！");
            return;
        } else if (input[0].value !== "" && input[1].value === "" && input[2].value === "") {
            $.each(configuration.data, function (i, n) {
                $.each(n.exceptionURL, function (j, m) {
                    if (m === input[0].value && featureID.indexOf(n.featureID)==-1) {
                        arr.push(n);
                        featureID.push(n.featureID);
                    }
                })
            });
        } else if (input[0].value === "" && input[1].value !== "" && input[2].value === "") {
            $.each(configuration.data, function (i, n) {
                (n.featureID === input[1].value) && arr.push(n);
            });
        } else if (input[0].value === "" && input[1].value === "" && input[2].value !== "") {
            $.each(configuration.data, function (i, n) {
                $.each(n.exceptionIp,function(j,m){
                    (m === input[2].value) && arr.push(n);
                })
            });
        } else if (input[0].value !== "" && input[1].value !== "" && input[2].value === "") {
            $.each(configuration.data, function (i, n) {
                if(n.featureID === input[1].value){
                    $.each(n.exceptionURL, function (j, m){
                        (m===input[0].value) && arr.push(n);
                    })
                }
            });
        } else if (input[0].value === "" && input[1].value !== "" && input[2].value !== "") {
            $.each(configuration.data, function (i, n) {
                if(n.featureID === input[1].value){
                    $.each(n.exceptionIp, function (j, m){
                        (m===input[2].value) && arr.push(n);
                    })
                }
            });
        } else if (input[0].value !== "" && input[1].value !== "" && input[2].value !== "") {
            $.each(configuration.data, function (i, n) {
                if(n.featureID === input[1].value){
                    $.each(n.exceptionURL, function (j, m){
                        (m===input[0].value) && (mark=true);
                    });
                    $.each(n.exceptionIp, function (k, q){
                        if(q===input[2].value && mark && featureID.indexOf(n.featureID)){
                            arr.push(n);
                            featureID.push(n.featureID);
                        }
                    });
                }
            });
        }
        if (arr.length == 0) {
            tipWarning(tipC, tip1, tipP, "没有所查数据信息！")
        } else {
            filter2={
                record_count:configuration.record_count,
                page_size:configuration.page_size,
                page_count : configuration.page_count,
                cur_page : configuration.cur_page,
                data : arr
            };
            $("#configuration").removeClass("active").siblings("table").addClass("active");
            addData("filter2");
        }
    });

    //跳转到添加页面
    var add = $("#exceptions-configuration .bt-bars li:first-child"),
        add1 = $("#WAF-strategy .bt-bars li:first-child");
    var m = 1;
    //WAF添加页
    add1.click(function () {
        var WInput = $("#WAF-strategy-add .portlet-title table input");
        $("#WAF-strategy-add").addClass("active").siblings("div").removeClass("active");
        WInput[0].value = "";
        WInput.removeAttr("disabled");
        if (1 == m) {
            addData("basicCharacteristics");
            setTimeout(function () {
                $("#basicCharacteristics").treetable({expandable: true});
            }, 200);
        }
        m++;
    });
    //例外配置添加页
    add.click(function () {
        $("#exceptions-configuration-add").addClass("active").siblings("div").removeClass("active");
        var str = "";
        for (var i = 0; i < 10; i++) {
            str += gridFour;
        }
        $('.con-add .row-add .tContainer tbody').html(str);
    });
    //删除按键
    var tipC = $(".tip-container"),
            tip1 = $(".tip1"),
            tipP = $(".tip-container p"),
            child,
            tbody = $(".portlet-wrapper .tab-pane tbody");
    //删除按键
    tbody.delegate("tr td:last-child img", "click", function () {
        tipC.show();
        tip.show().siblings("div").hide();
        var text = $(this).parent().siblings("[data-name='name']").text();
        ($("#exceptions-host").hasClass("active") && $("#intrusion-protection-strategy").hasClass("active")) ?
                tipP.text("确认删除例外主机‘" + text + "’?")
                : ($("#exceptions-configuration").hasClass("active") && $("#application-security-policy").hasClass("active")) ?
                tipP.text("确认删除例外配置‘" + text + "’?")
                : tipP.text("确认删除‘" + text + "’?");
        child = $(this);
    })
        //复制按键
            .delegate("tr td:nth-last-child(2) img", "click", function () {
                var name = $(this).parent().siblings("[data-name='name']").text(), copy = {}, index = 0, j, length, arr = [];
                if ($("#application-security-policy").hasClass("active")) {
                    if ($("#WAF-strategy").hasClass("active")) {
                        length = WAFIntrusion.data.length;
                        $.each(WAFIntrusion.data, function (i, n) {
                            if (n.name === name) {
                                copy = {
                                    id: n.id + 1,
                                    feature: n.feature,
                                    agreementSafe: n.agreementSafe,
                                    contentSafe: n.contentSafe,
                                    reference: n.reference,
                                    matching: n.matching
                                };
                                index = i;
                            }
                            if (name.indexOf("副本") == -1) {
                                if (n.name.indexOf(name + "副本") != -1) {
                                    arr.push(n.name);
                                }
                            } else if (n.name.indexOf(name.slice(0, name.indexOf("副本") + 2)) != -1) {
                                arr.push(n.name);
                            }
                            arr.sort(function (a, b) {
                                return parseInt(b.slice(b.indexOf("副本") + 3)) - parseInt(a.slice(a.indexOf("副本") + 3))
                            })
                        });
                        $.each(WAFIntrusion.data, function (i, n) {
                            if (n.name === arr[0]) {
                                index = i
                            }
                        });
                        (arr.length == 0) ?
                                copy.name = name + "副本(1)"
                                : copy.name = arr[0].slice(0, arr[0].indexOf("副本") + 2) + "(" + (parseInt(arr[0].slice(arr[arr.length - 1].indexOf("副本") + 3)) + 1) + ")";
                        for (j = length - 1; j > index; j--) {
                            WAFIntrusion.data[j + 1] = WAFIntrusion.data[j];
                            WAFIntrusion.data[j + 1].id = WAFIntrusion.data[j].id + 1;
                        }
                        WAFIntrusion.data[index + 1] = copy;
                        addData("WAFIntrusion");
                    } else if ($("#exceptions-configuration").hasClass("active")) {
                        length = configuration.data.length;
                        $.each(configuration.data, function (i, n) {
                            if (n.featureID === name) {
                                copy = {
                                    id: n.id + 1,
                                    type: n.type,
                                    featureName: n.featureName,
                                    exceptionIp: n.exceptionIp,
                                    exceptionURL: n.exceptionURL
                                };
                                index = i;
                            }
                            if (name.indexOf("副本") == -1) {
                                if (n.featureID.indexOf(name + "副本") != -1) {
                                    arr.push(n.featureID);
                                }
                            } else if (n.featureID.indexOf(name.slice(0, name.indexOf("副本") + 2)) != -1) {
                                arr.push(n.featureID);
                            }
                            arr.sort(function (a, b) {
                                return parseInt(b.slice(b.indexOf("副本") + 3)) - parseInt(a.slice(a.indexOf("副本") + 3))
                            })
                        });
                        $.each(configuration.data, function (i, n) {
                            if (n.featureID === arr[0]) {
                                index = i;
                            }
                        });
                        (arr.length == 0) ?
                                copy.featureID = name + "副本(1)"
                                : copy.featureID = arr[0].slice(0, arr[0].indexOf("副本") + 2) + "(" + (parseInt(arr[0].slice(arr[arr.length - 1].indexOf("副本") + 3)) + 1) + ")";
                        for (j = length - 1; j > index; j--) {
                            configuration.data[j + 1] = configuration.data[j];
                            configuration.data[j + 1].id = configuration.data[j].id + 1;
                        }
                        configuration.data[index + 1] = copy;
                        addData("configuration");
                    }
                } else if ($("#intrusion-protection-strategy").hasClass("active")) {
                    if ($("#intrusion-protection").hasClass("active")) {
                        length = intrusion.data.length;
                        $.each(intrusion.data, function (i, n) {
                            if (n.name === name) {
                                copy = {
                                    id: n.id + 1,
                                    feature: n.feature,
                                    name: n.name,
                                    reference: n.reference,
                                    matching: n.matching
                                };
                                index = i;
                            }
                            if (name.indexOf("副本") == -1) {
                                if (n.name.indexOf(name + "副本") != -1) {
                                    arr.push(n.name);
                                }
                            } else if (n.name.indexOf(name.slice(0, name.indexOf("副本") + 2)) != -1) {
                                arr.push(n.name);
                            }
                            arr.sort(function (a, b) {
                                return parseInt(b.slice(b.indexOf("副本") + 3)) - parseInt(a.slice(a.indexOf("副本") + 3))
                            })
                        });
                        $.each(intrusion.data, function (i, n) {
                            if (n.name === arr[0]) {
                                index = i
                            }
                        });
                        (arr.length == 0) ?
                                copy.name = name + "副本(1)"
                                : copy.name = arr[0].slice(0, arr[0].indexOf("副本") + 2) + "(" + (parseInt(arr[0].slice(arr[arr.length - 1].indexOf("副本") + 3)) + 1) + ")";
                        for (j = length - 1; j > index; j--) {
                            intrusion.data[j + 1] = intrusion.data[j];
                            intrusion.data[j + 1].id = intrusion.data[j].id + 1;
                        }
                        intrusion.data[index + 1] = copy;
                        addData("intrusion");
                    } else if ($("#exceptions-host").hasClass("active")) {
                        length = exceptions.data.length;
                        $.each(exceptions.data, function (i, n) {
                            if (n.featureID === name) {
                                copy = {
                                    id: n.id + 1,
                                    type: n.type,
                                    featureName: n.featureName,
                                    exceptionId: n.exceptionId
                                };
                                index = i;
                            }
                            if (name.indexOf("副本") == -1) {
                                if (n.featureID.indexOf(name + "副本") != -1) {
                                    arr.push(n.featureID);
                                }
                            } else if (n.featureID.indexOf(name.slice(0, name.indexOf("副本") + 2)) != -1) {
                                arr.push(n.featureID);
                            }
                            arr.sort(function (a, b) {
                                return parseInt(b.slice(b.indexOf("副本") + 3)) - parseInt(a.slice(a.indexOf("副本") + 3))
                            })
                        });
                        $.each(exceptions.data, function (i, n) {
                            if (n.featureID === arr[0]) {
                                index = i;
                            }
                        });
                        (arr.length == 0) ?
                                copy.featureID = name + "副本(1)"
                                : copy.featureID = arr[0].slice(0, arr[0].indexOf("副本") + 2) + "(" + (parseInt(arr[0].slice(arr[arr.length - 1].indexOf("副本") + 3)) + 1) + ")";
                        for (j = length - 1; j > index; j--) {
                            exceptions.data[j + 1] = exceptions.data[j];
                            exceptions.data[j + 1].id = exceptions.data[j].id + 1;
                        }
                        exceptions.data[index + 1] = copy;
                        addData("exceptions");
                    }
                }
            })
        //修改按键
            .delegate("tr td:nth-last-child(3) img", "click", function () {
                var name = $(this).parent().siblings("[data-name='name']").text();
                if ($("#WAF-strategy").hasClass("active")) {
                    var input = $("#WAF-strategy-add .portlet-title table input")[0];
                    $("#WAF-strategy-add").addClass("active").siblings("div").removeClass("active");
                    input.value = name;
                    input.disabled = true;
                }
            });
    //提示面板取消和关闭按键
    $(".tip-container .close,.tip-footer button").click(function () { tipC.hide(); });
    var li = $(".bt-bars li:last-child"),
        chb;
    tbody.delegate("tr td:first-child input", "click", function () {
        var chbs = $(".portlet-wrapper .tab-pane tbody tr td:first-child input");
        chb = [];
        $.each(chbs, function (i, n) {
            if (n.checked) {
                chb.push($(this));
            }
        });
        (chb.length > 0) ? li.addClass("active") : li.removeClass("active");
    });
    //多选删除按钮/
    li.click(function () {
        if ($(this).hasClass("active")) {
            tipC.show();
            tip.show().siblings("div").hide();
            ($("#exceptions-host").hasClass("active") && $("#intrusion-protection-strategy").hasClass("active")) ?
                    tipP.text("确认删除所选例外主机?")
                    : ($("#exceptions-configuration").hasClass("active") && $("#application-security-policy").hasClass("active")) ?
                    tipP.text("确认删除所选例外配置?")
                    : tipP.text("确认删除所选项？");
        } else {
            tipWarning(tipC, tip1, tipP, "请先选择要处理的数据信息！");
        }
    });
    $(".tip .tip-footer button:first-child").click(function () {
        if (li.hasClass("active")) {
            var text;
            $.each(chb, function () {
                text = $(this).parent().siblings("[data-name='name']").text();
                delInformation(text);
            });
            li.removeClass("active");
        } else {
            text = child.parents("tr").children("[data-name='name']").text();
            delInformation(text, child);
        }
    });

</script>