<!--安全策略-应用安全策略-WAF策略-->
<div class="portlet" >
    <div class="portlet-title">
        <div class="caption caption-none">
            <ul class="bt-bars">
                <li class="active"><a href="javascript:;"><img src="imgs/8.png"/>添加</a></li>
                <li><a href="javascript:;"><img src="imgs/delete.png"/>删除</a></li>
            </ul>
        </div>
    </div>
    <table class="portlet-table active portlet-body-default-none" id="WAFIntrusion">
        <thead>
        <tr>
            <td>选择</td>
            <td>名称</td>
            <td>WAF特征</td>
            <td>协议安全</td>
            <td>内容安全</td>
            <td>引用</td>
            <td>匹配</td>
            <td colspan="3">操作</td>
        </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
        <tr>
            <td colspan="10">
                <ul>
                </ul>
            </td>
        </tr>
        </tfoot>
    </table>
</div>
<script>
    var tbody = $(".portlet-wrapper .tab-pane tbody"),//表格主体
    //提示框
            tipC = $(".tip-container"),
            tip = $(".tip"),
            tip1 = $(".tip1"),
            tipAll=$(".tip, .tip1"),
            tipP = $(".tip-container p"),
            li = $(".bt-bars li:last-child"),//删除按钮
            child;
    addData("WAFIntrusion");//WAF策略表格
    position();//提示框位置
        //删除按键
    tbody.delegate("tr td:last-child img", "click", function () {
        child=$(this);
        tableDel(child,tipC,tip,tipP);
    })
        //复制按键
            .delegate("tr td:nth-last-child(2) img", "click", function () {
                var name = $(this).parent().siblings("[data-name='name']").text(),//对应行的名称
                        copy = {},//复制的预备对象
                        index = 0,
                        length = WAFIntrusion.data.length,
                        arr = [];
                $.each(WAFIntrusion.data, function (i, n) {
                    if (n.name === name) {
                        copy = {
                            id: n.id + 1,
                            feature: n.feature,
                            agreementSafe: n.agreementSafe,
                            contentSafe: n.contentSafe,
                            reference: n.reference,
                            matching: n.matching
                        };
                        index = i;
                    }
                    if (name.indexOf("副本") == -1) {
                        (n.name.indexOf(name + "副本") != -1) && arr.push(n.name);
                    } else if (n.name.indexOf(name.slice(0, name.indexOf("副本") + 2)) != -1) {
                        arr.push(n.name);
                    }
                    arr.sort(function (a, b) {
                        return parseInt(b.slice(b.indexOf("副本") + 3)) - parseInt(a.slice(a.indexOf("副本") + 3))
                    })
                });
                $.each(WAFIntrusion.data, function (i, n) { (n.name === arr[0]) && (index = i) });
                (arr.length == 0) ?
                        copy.name = name + "副本(1)"
                        : copy.name = arr[0].slice(0, arr[0].indexOf("副本") + 2) + "(" + (parseInt(arr[0].slice(arr[arr.length - 1].indexOf("副本") + 3)) + 1) + ")";
                for (var j = length - 1; j > index; j--) {
                    WAFIntrusion.data[j + 1] = WAFIntrusion.data[j];
                    WAFIntrusion.data[j + 1].id = WAFIntrusion.data[j].id + 1;
                }
                WAFIntrusion.data[index + 1] = copy;
                addData("WAFIntrusion");
            })
        //修改按键
            .delegate("tr td:nth-last-child(3) img", "click", function () {
                var name = $(this).parent().siblings("[data-name='name']").text();
                $("#WAF-strategy-add").addClass("active")
                                      .load("data/security-policy/application-security-policy/WAF-strategy-add.html")
                                      .siblings("div").removeClass("active");
            })
        //选择框
            .delegate("tr td:first-child input", "click", function () {
                checkBox(li);
            });
    //多选删除按钮/
    li.click(function () {
        var me=$(this);
        liDel(me,tipC,tip,tipP,tip1);
    });
    //WAF添加页
    $("#WAF-strategy .bt-bars li:first-child").click(function () {
        $("#WAF-strategy-add").addClass("active")
                .load("data/security-policy/application-security-policy/WAF-strategy-add/WAF-strategy-add.html")
                .siblings("div").removeClass("active");
    });
</script>