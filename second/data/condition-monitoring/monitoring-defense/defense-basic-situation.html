<!--状态监控-检测防御-基本概况-->
<!--第一行 三个模块-->
<div class="row">
    <div class="col-md-4 col-sm-6 col-xs-12">
        <div class="dashboard-stat">
            <div class="visual">
                <img src="imgs/trigger-event.png"/>
            </div>
            <div class="condition-details t">
                <p><span></span>次</p>
                <p>触发事件</p>
            </div>
        </div>
    </div>
    <div class="col-md-4 col-sm-6 col-xs-12">
        <div class="dashboard-stat">
            <div class="visual">
                <img src="imgs/intercept-events.png"/>
            </div>
            <div class="condition-details d">
                <p><span></span>次</p>
                <p>拦截事件</p>
            </div>
        </div>
    </div>
    <div class="col-md-4 col-sm-6 col-xs-12">
        <div class="dashboard-stat">
            <div class="visual">
                <img src="imgs/risk-host.png"  />
            </div>
            <div class="condition-details h">
                <p><span></span></p>
                <p>风险主机</p>
            </div>
        </div>
    </div>
</div>
<div class="clearfix"></div>
<!--第二行 攻击地图+攻击源排名-->
<div class="row">
    <!--攻击地图-->
    <div class="col-md-6 col-sm-6">
        <div class="portlet bordered">
            <div class="portlet-title">
                <div class="caption">
                    <span class="caption-subject bold uppercase">攻击地图</span>
                    <form>
                        <p class="pull-right">
                            <span>本地外网IP</span>
                            <input/>
                        </p>
                    </form>
                </div>
            </div>
            <div class="portlet-body map">
                <div id="attack-map" class="canvas pull-left"></div>
                <table class="portlet-table pull-right active" id="mapData">
                    <thead>
                    <tr>
                        <td>地区</td>
                        <td>次数</td>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
    <!--攻击源排名-->
    <div class="col-md-6 col-sm-6">
        <div class="portlet bordered">
            <div class="portlet-title">
                <div class="caption">
                    <span class="caption-subject bold uppercase">攻击源排名</span>
                </div>
            </div>
            <div class="portlet-body">
                <div id="attack-source-ranking" class="canvas pull-left"></div>
                <table id="attackSource" class="portlet-table pull-right active">
                    <thead>
                    <tr>
                        <td>排名</td>
                        <td>IP</td>
                        <td>次数</td>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<!--第三行-->
<div class="row">
    <!--威胁安全趋势-->
    <div class="col-md-6 col-sm-6">
        <div class="portlet bordered">
            <div class="portlet-title">
                <div class="caption">
                    <span class="caption-subject bold uppercase">威胁安全趋势</span>
                </div>
            </div>
            <div class="portlet-body">
                <div id="security-trend" class="canvas"></div>
            </div>
        </div>
    </div>
    <!--攻击目的排名-->
    <div class="col-md-6 col-sm-6">
        <div class="portlet bordered">
            <div class="portlet-title">
                <div class="caption">
                    <span class="caption-subject bold uppercase">攻击目的排名</span>
                </div>
            </div>
            <div class="portlet-body">
                <div id="attack-purposes-ranking" class="canvas pull-left"></div>
                <table class="portlet-table pull-right active" id="attackPurposes">
                    <thead>
                    <tr>
                        <td>排名</td>
                        <td>IP</td>
                        <td>次数</td>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
<script>
    var dataMTime,//三个数据的计数器
            select2=$("#selectEd2");//检测防御数据更新定时器标记
    //第一行的三个数据
    dataM();
    clearInterval(dataMTime);
    dataMTime = setInterval(dataM, 1000);
    securityTrend("security-trend");//威胁安全趋势
    //攻击地图
    addData("mapData");
    attackMap("attack-map");
    //攻击源排名
    attackSourceRanking('attack-source-ranking');
    addData("attackSource");
    //攻击目的排名
    attackPurposesRanking('attack-purposes-ranking');
    addData("attackPurposes");

    //时间区间选择
    select2.on("change", function () {
        securityTrend("security-trend", $(this).val());
    });

    var relationship = $("#attack-system-analysis-relationship"),//关系图
            analysisSelector=$(".filter-conditions ul li:first-child"),//过滤
            relationshipPie = $("#attack-system-analysis-relationship-pie");//饼图
    //攻击地图统计分析（功能有待改善）
    $("#mapData").delegate("a", "click", function (e) {
        e.preventDefault();
        var href = $(this)[0].hash;
        attackData = tab("attackSystemData");
        $(href).addClass("active").siblings("div").removeClass("active");
//        console.log($(this).text());
//        console.log($(this).parent().prev().text());
        attackRelationship(attackData);
        analysisSelector.children("p").text("当前源：" + attackData.data[0].target);
        $("#attackSystemData").addClass("active").siblings("table").removeClass("active");
        addData("attackSystemData");
        $(".filter-conditions button").click(function () {
            $(this).siblings("button").removeAttr("disabled");
            $(this).attr("disabled", "true");
            var div = $(this).siblings("div");
            if ($(this)[0].className === "btn-right") {
                relationship.removeClass("active");
                relationshipPie.addClass("active");
                attackRelationshipPie(tab("attackSystemData"));
            } else {
                relationshipPie.removeClass("active");
                relationship.addClass("active");
                attackRelationship(tab("attackSystemData"));
            }
        });
    });
    //攻击源统计分析
    $("#attackSource").delegate("a", "click", function (e) {
        e.preventDefault();//阻止跳转
        var source = "attackSystemDataSource",//攻击源排名
                me = $(this);
        analysis(relationship, relationshipPie, me, source, "filter1",analysisSelector);
    });
    //攻击目的统计分析
    $("#attackPurposes").delegate("a", "click", function (e) {
        e.preventDefault();//阻止跳转
        var source = "attackSystemDataAttack",//攻击目的排名
                me = $(this);
        analysis(relationship, relationshipPie, me, source, "filter",analysisSelector);
    });
</script>