<!--3.3.状态监控-WAF-->
<div id="WAF" class="page-content-wrapper analysis">
    <div class="page-content condition-wrapper active" id="WAF-normal">
        <!--第一行 页签-->
        <div class="portlet tab-border">
            <div class="portlet-title">
                <ul class="nav nav-tabs " role="tablist">
                    <li role="presentation" class="active">
                        <a href="#attack-statistics" aria-controls="home" role="tab" data-toggle="tab">攻击统计</a>
                        <span class="selected"></span>
                    </li>
                    <li role="presentation">
                        <a href="#web-threats" aria-controls="home" role="tab" data-toggle="tab">WEB威胁</a>
                        <span></span>
                    </li>
                    <li role="presentation">
                        <a href="#web-caching" aria-controls="home" role="tab" data-toggle="tab">WEB缓存</a>
                        <span></span>
                    </li>
                    <li role="presentation">
                        <a href="#real-time-monitoring" aria-controls="home" role="tab" data-toggle="tab">实时监测</a>
                        <span></span>
                    </li>
                    <li class="pull-right">
                        <form>
                            <span>查询区间</span>
                            <select id="selectEd3">
                                <option value="">请选择</option>
                                <option value="300000">5分钟</option>
                                <option value="3600000">1小时</option>
                                <option value="86400000">1天</option>
                                <option value="2592000000">1个月</option>
                            </select>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
        <!--第二行 页签切换块-->
        <div class="tab-content">
            <!--攻击统计-->
            <div role="tabpanel" class="tab-pane active" id="attack-statistics">
                <!--第一行 三个模块-->
                <div class="row">
                    <div class="col-md-4 col-sm-6 col-xs-12">
                        <div class="dashboard-stat waf">
                            <div class="visual">
                                <img src="imgs/waf-5.png"/>
                            </div>
                            <div class="condition-details f">
                                <p><span></span>连接数</p>
                                <p>当前访问</p>
                            </div>
                            <span class="angle"></span>
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6 col-xs-12">
                        <div class="dashboard-stat waf">
                            <div class="visual">
                                <img src="imgs/waf-6.png"/>
                            </div>
                            <div class="condition-details l">
                                <p><span></span>次</p>
                                <p>拦截事件</p>
                            </div>
                            <span class="angle"></span>
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6 col-xs-12">
                        <div class="dashboard-stat waf">
                            <div class="visual">
                                <img src="imgs/waf-7.png"  />
                            </div>
                            <div class="condition-details b">
                                <p><span></span>次</p>
                                <p>病毒事件</p>
                            </div>
                            <span class="angle"></span>
                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>
                <!--第二行 攻击地图+攻击源排名-->
                <div class="row">
                    <!--攻击地图-->
                    <div class="col-md-6 col-sm-6">
                        <div class="portlet bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <span class="caption-subject bold uppercase">攻击地图</span>
                                    <form>
                                        <p class="pull-right">
                                            <span>本地外网IP</span>
                                            <input/>
                                        </p>
                                    </form>
                                </div>
                            </div>
                            <div class="portlet-body map">
                                <div id="attack-map1" class="canvas pull-left"></div>
                                <table class="portlet-table pull-right active" id="mapData2">
                                    <thead>
                                    <tr>
                                        <td>来源</td>
                                        <td>次数</td>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
                    <!--URL-TOP10-->
                    <div class="col-md-6 col-sm-6">
                        <div class="portlet bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <span class="caption-subject bold uppercase">URL-TOP10</span>
                                </div>
                            </div>
                            <div class="portlet-body">
                                <div id="attack-source-ranking1" class="canvas pull-left"></div>
                                <table id="attackSource2" class="portlet-table pull-right active">
                                    <thead>
                                    <tr>
                                        <td>序号</td>
                                        <td>URL</td>
                                        <td>次数</td>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
                <!--第三行-->
                <div class="row">
                    <!--威胁安全趋势-->
                    <div class="col-md-6 col-sm-6">
                        <div class="portlet bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <span class="caption-subject bold uppercase">攻击数量统计-URL</span>
                                </div>
                            </div>
                            <div class="portlet-body">
                                <div id="security-trend1" class="canvas"></div>
                            </div>
                        </div>
                    </div>
                    <!--源URL-TOP10-->
                    <div class="col-md-6 col-sm-6">
                        <div class="portlet bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <span class="caption-subject bold uppercase">源URL-TOP10</span>
                                </div>
                            </div>
                            <div class="portlet-body">
                                <div id="attack-purposes-ranking1" class="canvas pull-left"></div>
                                <table class="portlet-table pull-right active" id="attackPurposes2">
                                    <thead>
                                    <tr>
                                        <td>排名</td>
                                        <td>IP</td>
                                        <td>次数</td>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--WEB威胁-->
            <div role="tabpanel" class="tab-pane" id="web-threats">
                <!--第一行 会话信息-->
                <div class="portlet bordered tab-pane" >
                    <div class="portlet-title">
                        <div class="caption">
                            <span class="caption-subject bold uppercase">会话信息</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                    </div>
                </div>
                <!--第二行 接口信息-->
                <div class="portlet bordered tab-pane" >
                    <div class="portlet-title">
                        <div class="caption">
                            <span class="caption-subject bold uppercase">接口信息</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                    </div>
                </div>
            </div>
            <!--WEB缓存-->
            <div role="tabpanel" class="tab-pane" id="web-caching">
                <!--第一行 会话信息-->
                <div class="portlet bordered tab-pane" >
                    <div class="portlet-title">
                        <div class="caption">
                            <span class="caption-subject bold uppercase">会话信息</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                    </div>
                </div>
                <!--第二行 接口信息-->
                <div class="portlet bordered tab-pane" >
                    <div class="portlet-title">
                        <div class="caption">
                            <span class="caption-subject bold uppercase">接口信息</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                    </div>
                </div>
            </div>
            <!--实时监测-->
            <div role="tabpanel" class="tab-pane" id="real-time-monitoring">
                <!--第一行 会话信息-->
                <div class="portlet bordered tab-pane" >
                    <div class="portlet-title">
                        <div class="caption">
                            <span class="caption-subject bold uppercase">会话信息</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                    </div>
                </div>
                <!--第二行 接口信息-->
                <div class="portlet bordered tab-pane" >
                    <div class="portlet-title">
                        <div class="caption">
                            <span class="caption-subject bold uppercase">接口信息</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="page-content condition-wrapper" id="WAF-attack-system-analysis">
        <!--第一行 页签-->
        <div class="portlet tab-border">
            <div class="portlet-title">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a>攻击统计分析</a>
                        <span class="selected"></span>
                    </li>
                </ul>
            </div>
        </div>
        <!--第二行 页签切换块-->
        <div class="tab-content">
            <!--第一行 图表-->
            <div class="portlet tab-pane-attack" >
                <div class="portlet-body filter-conditions">
                    <div id="attack-system-analysis-relationship" class="two-canvas active"></div>
                    <div id="attack-system-analysis-relationship-pie" class="two-canvas "></div>
                    <ul>
                        <li class="active">
                            <p></p>
                        </li>
                        <li id="source">
                            <p></p>
                            <i class="icon-close"></i>
                        </li>
                        <li id="type">
                            <p>b</p>
                            <i class="icon-close"></i>
                        </li>
                        <li id="name">
                            <p>c</p>
                            <i class="icon-close"></i>
                        </li>
                    </ul>
                    <button class="btn-left" disabled="disabled">
                        <i class="fa fa-chevron-left"></i>
                    </button>
                    <button class="btn-right">
                        <i class="fa fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            <!--第二行 攻击系统数据详情-->
            <div class="portlet bordered" >
                <div class="portlet-title">
                    <div class="caption">
                        <span class="caption-subject bold uppercase">攻击系统数据详情</span>
                    </div>
                </div>
                <table class="portlet-table active " id="attackSystemData">
                    <thead>
                    <tr>
                        <td>事件编号</td>
                        <td>攻击源</td>
                        <td>攻击目标</td>
                        <td>攻击类型</td>
                        <td>次数</td>
                        <td>匹配事件</td>
                        <td colspan="3">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="9">
                            <ul>
                            </ul>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                <table class="portlet-table " id="attackSystemDataAttack">
                    <thead>
                    <tr>
                        <td>事件编号</td>
                        <td>攻击源</td>
                        <td>攻击目标</td>
                        <td>攻击类型</td>
                        <td>次数</td>
                        <td>匹配事件</td>
                        <td colspan="3">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="9">
                            <ul>
                            </ul>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                <table class="portlet-table " id="attackSystemDataSource">
                    <thead>
                    <tr>
                        <td>事件编号</td>
                        <td>攻击源</td>
                        <td>攻击目标</td>
                        <td>攻击类型</td>
                        <td>次数</td>
                        <td>匹配事件</td>
                        <td colspan="3">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="9">
                            <ul>
                            </ul>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                <table class="portlet-table " id="filter">
                    <thead>
                    <tr>
                        <td>事件编号</td>
                        <td>攻击目标</td>
                        <td>攻击源</td>
                        <td>攻击类型</td>
                        <td>次数</td>
                        <td>匹配事件</td>
                        <td colspan="3">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="9">
                            <ul>
                            </ul>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                <table class="portlet-table " id="filter1">
                    <thead>
                    <tr>
                        <td>事件编号</td>
                        <td>攻击目标</td>
                        <td>攻击源</td>
                        <td>攻击类型</td>
                        <td>次数</td>
                        <td>匹配事件</td>
                        <td colspan="3">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="9">
                            <ul>
                            </ul>
                        </td>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    var dataMTime1,//WAF数据更新定时器标记
        select3=$("#selectEd3");//WAF界面时间区间选择框

    //攻击统计——第一行三个实时更新的数据
    dataM1();
    clearInterval(dataMTime1);
    dataMTime1 = setInterval(dataM1, 1000);

    securityTrend("security-trend1");//威胁安全趋势
    //攻击地图（图+表）
    attackMap("attack-map1");
    addData("mapData2");
    //URL-TOP10（图+表）
    attackSourceRanking('attack-source-ranking1');
    addData("attackSource2");
    //源URL-TOP10（图+表）
    attackPurposesRanking('attack-purposes-ranking1');
    addData("attackPurposes2");

    //时间区间选择
    select3.on("change", function () {securityTrend("security-trend1", $(this).val())});

    //页签切换
    $(".nav-tabs li a").click(function () {
        var href = $(this)[0].hash;
        select3.val("");//清空选择框
        if(href==="attack-statistics"){                                         //攻击统计
            //威胁安全趋势
            setTimeout('securityTrend("security-trend1")',200);
            //攻击地图
            setTimeout('attackMap("attack-map1")',200);
            addData("mapData2");
            //URL-TOP10
            setTimeout("attackSourceRanking('attack-source-ranking1')",200);
            addData("attackSource2");
            //源URL-TOP10
            setTimeout("attackPurposesRanking('attack-purposes-ranking1')",200);
            addData("attackPurposes2");
        }
        $(this).siblings("span").addClass("selected");//标签下标识
    });

    var analysisSelector=$(".filter-conditions ul li:first-child"),//过滤条件
        relationship = $("#attack-system-analysis-relationship"),//关系图
        relationshipPie = $("#attack-system-analysis-relationship-pie");//饼图
    //攻击地图统计分析（功能有待完善）
    $("#mapData2").delegate("a", "click", function (e) {
        e.preventDefault();
        var href = $(this)[0].hash;
            attackData = tab("attackSystemData");
        $(href).addClass("active").siblings("div").removeClass("active");
//        console.log($(this).text());
//        console.log($(this).parent().prev().text());
        attackRelationship(attackData);
        analysisSelector.children("p").text("当前源：" + attackData.data[0].target);
        $("#attackSystemData").addClass("active").siblings("table").removeClass("active");
        addData("attackSystemData");
        //左右切换按钮
        $(".filter-conditions button").click(function () {
            $(this).siblings("button").removeAttr("disabled");
            $(this).attr("disabled", "true");
            var div = $(this).siblings("div");
            if ($(this)[0].className === "btn-right") {
                relationship.removeClass("active");
                relationshipPie.addClass("active");
                attackRelationshipPie(tab("attackSystemData"));
            } else {
                relationshipPie.removeClass("active");
                relationship.addClass("active");
                attackRelationship(tab("attackSystemData"));
            }
        });
    });
    //攻击源统计分析
    $("#attackSource2").delegate("a", "click", function (e) {
        e.preventDefault();//阻止跳转
        var me = $(this);
        analysis(relationship, relationshipPie, me, "attackSystemDataSource", "filter1",analysisSelector);
    });
    //攻击目的统计分析
    $("#attackPurposes2").delegate("a", "click", function (e) {
        e.preventDefault();//阻止跳转
        var me = $(this);
        analysis(relationship, relationshipPie, me, "attackSystemDataAttack", "filter",analysisSelector);
    });
</script>