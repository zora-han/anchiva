<!--3.2.状态监控-监测防御-->
<div id="monitoring-defense" class="page-content-wrapper analysis">
    <div class="page-content condition-wrapper active" id="defense-normal">
        <!--第一行 页签-->
        <div class="portlet tab-border">
            <div class="portlet-title">
                <ul class="nav nav-tabs " role="tablist">
                    <li role="presentation" class="active">
                        <a href="#defense-basic-situation" aria-controls="home" role="tab" data-toggle="tab">基本概况</a>
                        <span class="selected"></span>
                    </li>
                    <li role="presentation">
                        <a href="#defense-time-monitoring" aria-controls="home" role="tab" data-toggle="tab">实时监控</a>
                        <span></span>
                    </li>
                    <li class="pull-right">
                        <span>查询区间</span>
                        <select id="selectEd2">
                            <option value="">请选择</option>
                            <option value="300000">5分钟</option>
                            <option value="3600000">1小时</option>
                            <option value="86400000">1天</option>
                            <option value="2592000000">1个月</option>
                        </select>
                    </li>
                </ul>
            </div>
        </div>
        <!--第二行 页签切换块-->
        <div class="tab-content">
            <!--基本概况块-->
            <div role="tabpanel" class="tab-pane active" id="defense-basic-situation">
                <!--第一行 三个模块-->
                <div class="row">
                    <div class="col-md-4 col-sm-6 col-xs-12">
                        <div class="dashboard-stat">
                            <div class="visual">
                                <img src="imgs/trigger-event.png"/>
                            </div>
                            <div class="condition-details t">
                                <p><span></span>次</p>
                                <p>触发事件</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6 col-xs-12">
                        <div class="dashboard-stat">
                            <div class="visual">
                                <img src="imgs/intercept-events.png"/>
                            </div>
                            <div class="condition-details d">
                                <p><span></span>次</p>
                                <p>拦截事件</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-sm-6 col-xs-12">
                        <div class="dashboard-stat">
                            <div class="visual">
                                <img src="imgs/risk-host.png"  />
                            </div>
                            <div class="condition-details h">
                                <p><span></span></p>
                                <p>风险主机</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="clearfix"></div>
                <!--第二行 攻击地图+攻击源排名-->
                <div class="row">
                    <!--攻击地图-->
                    <div class="col-md-6 col-sm-6">
                        <div class="portlet bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <span class="caption-subject bold uppercase">攻击地图</span>
                                    <form>
                                        <p class="pull-right">
                                            <span>本地外网IP</span>
                                            <input/>
                                        </p>
                                    </form>
                                </div>
                            </div>
                            <div class="portlet-body map">
                                <div id="attack-map" class="canvas pull-left"></div>
                                <table class="portlet-table pull-right active" id="mapData">
                                    <thead>
                                    <tr>
                                        <td>地区</td>
                                        <td>次数</td>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
                    <!--攻击源排名-->
                    <div class="col-md-6 col-sm-6">
                        <div class="portlet bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <span class="caption-subject bold uppercase">攻击源排名</span>
                                </div>
                            </div>
                            <div class="portlet-body">
                                <div id="attack-source-ranking" class="canvas pull-left"></div>
                                <table id="attackSource" class="portlet-table pull-right active">
                                    <thead>
                                    <tr>
                                        <td>排名</td>
                                        <td>IP</td>
                                        <td>次数</td>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
                <!--第三行-->
                <div class="row">
                    <!--威胁安全趋势-->
                    <div class="col-md-6 col-sm-6">
                        <div class="portlet bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <span class="caption-subject bold uppercase">威胁安全趋势</span>
                                </div>
                            </div>
                            <div class="portlet-body">
                                <div id="security-trend" class="canvas"></div>
                            </div>
                        </div>
                    </div>
                    <!--攻击目的排名-->
                    <div class="col-md-6 col-sm-6">
                        <div class="portlet bordered">
                            <div class="portlet-title">
                                <div class="caption">
                                    <span class="caption-subject bold uppercase">攻击目的排名</span>
                                </div>
                            </div>
                            <div class="portlet-body">
                                <div id="attack-purposes-ranking" class="canvas pull-left"></div>
                                <table class="portlet-table pull-right active" id="attackPurposes">
                                    <thead>
                                    <tr>
                                        <td>排名</td>
                                        <td>IP</td>
                                        <td>次数</td>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--实时监控块-->
            <div role="tabpanel" class="tab-pane" id="defense-time-monitoring">
                <!--第一行 会话信息-->
                <div class="portlet bordered tab-pane" >
                    <div class="portlet-title">
                        <div class="caption">
                            <span class="caption-subject bold uppercase">会话信息</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                    </div>
                </div>
                <!--第二行 接口信息-->
                <div class="portlet bordered tab-pane" >
                    <div class="portlet-title">
                        <div class="caption">
                            <span class="caption-subject bold uppercase">接口信息</span>
                        </div>
                    </div>
                    <div class="portlet-body">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--防御检测对应的攻击统计-->
    <div class="page-content condition-wrapper" id="defense-attack-system-analysis">
        <!--第一行 页签-->
        <div class="portlet tab-border">
            <div class="portlet-title">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a>攻击统计分析</a>
                        <span class="selected"></span>
                    </li>
                </ul>
            </div>
        </div>
        <!--第二行 主内容块-->
        <div class="tab-content">
            <!--第一行 图表-->
            <div class="portlet tab-pane-attack" >
                <div class="portlet-body filter-conditions">
                    <div id="attack-system-analysis-relationship" class="two-canvas active"></div>
                    <div id="attack-system-analysis-relationship-pie" class="two-canvas "></div>
                    <ul>
                        <li class="active">
                            <p></p>
                        </li>
                        <li id="source">
                            <p></p>
                            <i class="icon-close"></i>
                        </li>
                        <li id="type">
                            <p>b</p>
                            <i class="icon-close"></i>
                        </li>
                        <li id="name">
                            <p>c</p>
                            <i class="icon-close"></i>
                        </li>
                    </ul>
                    <button class="btn-left" disabled="disabled">
                        <i class="fa fa-chevron-left"></i>
                    </button>
                    <button class="btn-right">
                        <i class="fa fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            <!--第二行 攻击系统数据详情-->
            <div class="portlet bordered" >
                <div class="portlet-title">
                    <div class="caption">
                        <span class="caption-subject bold uppercase">攻击系统数据详情</span>
                    </div>
                </div>
                <table class="portlet-table active " id="attackSystemData">
                    <thead>
                    <tr>
                        <td>事件编号</td>
                        <td>攻击源</td>
                        <td>攻击目标</td>
                        <td>攻击类型</td>
                        <td>次数</td>
                        <td>匹配事件</td>
                        <td colspan="3">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="9">
                            <ul>
                            </ul>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                <table class="portlet-table " id="attackSystemDataAttack">
                    <thead>
                    <tr>
                        <td>事件编号</td>
                        <td>攻击源</td>
                        <td>攻击目标</td>
                        <td>攻击类型</td>
                        <td>次数</td>
                        <td>匹配事件</td>
                        <td colspan="3">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="9">
                            <ul>
                            </ul>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                <table class="portlet-table " id="attackSystemDataSource">
                    <thead>
                    <tr>
                        <td>事件编号</td>
                        <td>攻击源</td>
                        <td>攻击目标</td>
                        <td>攻击类型</td>
                        <td>次数</td>
                        <td>匹配事件</td>
                        <td colspan="3">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="9">
                            <ul>
                            </ul>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                <table class="portlet-table " id="filter">
                    <thead>
                    <tr>
                        <td>事件编号</td>
                        <td>攻击目标</td>
                        <td>攻击源</td>
                        <td>攻击类型</td>
                        <td>次数</td>
                        <td>匹配事件</td>
                        <td colspan="3">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="9">
                            <ul>
                            </ul>
                        </td>
                    </tr>
                    </tfoot>
                </table>
                <table class="portlet-table " id="filter1">
                    <thead>
                    <tr>
                        <td>事件编号</td>
                        <td>攻击目标</td>
                        <td>攻击源</td>
                        <td>攻击类型</td>
                        <td>次数</td>
                        <td>匹配事件</td>
                        <td colspan="3">操作</td>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="9">
                            <ul>
                            </ul>
                        </td>
                    </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    var dataMTime,
        select2=$("#selectEd2");//检测防御数据更新定时器标记
    //第一行的三个数据
    dataM();
    clearInterval(dataMTime);
    dataMTime = setInterval(dataM, 1000);
    securityTrend("security-trend");//威胁安全趋势
    //攻击地图
    addData("mapData");
    attackMap("attack-map");
    //攻击源排名
    attackSourceRanking('attack-source-ranking');
    addData("attackSource");
    //攻击目的排名
    attackPurposesRanking('attack-purposes-ranking');
    addData("attackPurposes");

    //时间区间选择
    select2.on("change", function () {
        securityTrend("security-trend", $(this).val());
    });

    //页签切换
    $(".nav-tabs li a").click(function () {
        var href = $(this)[0].hash;
        if (href === "#defense-basic-situation") {//状态监控——检测防御——基本概况
            //威胁安全趋势
            setTimeout('securityTrend("security-trend")', 200);
            //攻击地图
            setTimeout('attackMap("attack-map")', 200);
            attackMap("attack-map");
            //攻击源排名
            setTimeout("attackSourceRanking('attack-source-ranking')", 200);
            addData("attackSource");
            //攻击目的排名
            setTimeout("attackPurposesRanking('attack-purposes-ranking')", 200);
            addData("attackPurposes");
            select2.val("");//置空下拉框
        } else if (href === "#defense-time-monitoring") {//状态监控——检测防御——实时监控
            select2.val("");//置空下拉框
        }
        $(this).siblings("span").addClass("selected");//标签下标识
    });

    var relationship = $("#attack-system-analysis-relationship"),//关系图
            analysisSelector=$(".filter-conditions ul li:first-child"),//过滤
            relationshipPie = $("#attack-system-analysis-relationship-pie");//饼图
    //攻击地图统计分析（功能有待改善）
    $("#mapData").delegate("a", "click", function (e) {
        e.preventDefault();
        var href = $(this)[0].hash;
        attackData = tab("attackSystemData");
        $(href).addClass("active").siblings("div").removeClass("active");
//        console.log($(this).text());
//        console.log($(this).parent().prev().text());
        attackRelationship(attackData);
        analysisSelector.children("p").text("当前源：" + attackData.data[0].target);
        $("#attackSystemData").addClass("active").siblings("table").removeClass("active");
        addData("attackSystemData");
        $(".filter-conditions button").click(function () {
            $(this).siblings("button").removeAttr("disabled");
            $(this).attr("disabled", "true");
            var div = $(this).siblings("div");
            if ($(this)[0].className === "btn-right") {
                relationship.removeClass("active");
                relationshipPie.addClass("active");
                attackRelationshipPie(tab("attackSystemData"));
            } else {
                relationshipPie.removeClass("active");
                relationship.addClass("active");
                attackRelationship(tab("attackSystemData"));
            }
        });
    });
    //攻击源统计分析
    $("#attackSource").delegate("a", "click", function (e) {
        e.preventDefault();//阻止跳转
        var source = "attackSystemDataSource",//攻击源排名
                me = $(this);
        analysis(relationship, relationshipPie, me, source, "filter1",analysisSelector);
    });
    //攻击目的统计分析
    $("#attackPurposes").delegate("a", "click", function (e) {
        e.preventDefault();//阻止跳转
        var source = "attackSystemDataAttack",//攻击目的排名
                me = $(this);
        analysis(relationship, relationshipPie, me, source, "filter",analysisSelector);
    });
</script>